---
title: "nba"
output: html_document
date: "2024-06-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Importamos los datos
```{r}
library(readr)
jugadoresNBA_2023 <- read_delim("data/jugadoresNBA2023.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(AGE = col_number(), 
        GP = col_number(), W = col_number(), 
        L = col_number(), MIN = col_number(), 
        PTS = col_number(), FGM = col_number(), 
        FGA = col_number(), `FG%` = col_number(), 
        `3PM` = col_number(), `3PA` = col_number(), 
        `3P%` = col_number(), FTM = col_number(), 
        FTA = col_number(), `FT%` = col_number(), 
        OREB = col_number(), DREB = col_number(), 
        REB = col_number(), AST = col_number(), 
        TOV = col_number(), STL = col_number(), 
        BLK = col_number(), PF = col_number(), 
        FP = col_number(), DD2 = col_number(), 
        TD3 = col_number(), `+/-` = col_number()), 
    trim_ws = TRUE)

equipos2023 <- read_delim("data/equipos2023.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(GP = col_integer(), 
        W = col_integer(), L = col_integer(), 
        `WIN%` = col_number(), MIN = col_number(), 
        PTS = col_number(), FGM = col_number(), 
        FGA = col_number(), `FG%` = col_number(), 
        `3PM` = col_number(), `3PA` = col_number(), 
        `3P%` = col_number(), FTM = col_number(), 
        FTA = col_number(), `FT%` = col_number(), 
        OREB = col_number(), DREB = col_number(), 
        REB = col_number(), AST = col_number(), 
        TOV = col_number(), STL = col_number(), 
        BLK = col_number(), BLKA = col_number(), 
        PF = col_number(), PFD = col_number(), 
        `+/-` = col_number()), trim_ws = TRUE)

jugadoresNBA_2022 <- read_delim("data/jugadoresNBA2022.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(AGE = col_number(), 
        GP = col_number(), W = col_number(), 
        L = col_number(), MIN = col_number(), 
        PTS = col_number(), FGM = col_number(), 
        FGA = col_number(), `FG%` = col_number(), 
        `3PM` = col_number(), `3PA` = col_number(), 
        `3P%` = col_number(), FTM = col_number(), 
        FTA = col_number(), `FT%` = col_number(), 
        OREB = col_number(), DREB = col_number(), 
        REB = col_number(), AST = col_number(), 
        TOV = col_number(), STL = col_number(), 
        BLK = col_number(), PF = col_number(), 
        FP = col_number(), DD2 = col_number(), 
        TD3 = col_number(), `+/-` = col_number()), 
    trim_ws = TRUE)

equipos2022 <- read_delim("data/equipos2022.csv", 
    delim = ";", escape_double = FALSE, col_types = cols(GP = col_integer(), 
        W = col_integer(), L = col_integer(), 
        `WIN%` = col_number(), MIN = col_number(), 
        PTS = col_number(), FGM = col_number(), 
        FGA = col_number(), `FG%` = col_number(), 
        `3PM` = col_number(), `3PA` = col_number(), 
        `3P%` = col_number(), FTM = col_number(), 
        FTA = col_number(), `FT%` = col_number(), 
        OREB = col_number(), DREB = col_number(), 
        REB = col_number(), AST = col_number(), 
        TOV = col_number(), STL = col_number(), 
        BLK = col_number(), BLKA = col_number(), 
        PF = col_number(), PFD = col_number(), 
        `+/-` = col_number()), trim_ws = TRUE)
```

Limpieza de datos

```{r}
library(dplyr)
jugadoresNBA_2023 <- jugadoresNBA_2023 %>%
  mutate(PPG = PTS / GP) %>%
  select(PLAYER,TEAM,AGE,GP,W,L,MIN,PTS,PPG,everything()) %>%
  select(-FP)
jugadoresNBA_2022 <- jugadoresNBA_2022 %>%
  mutate(PPG = PTS / GP) %>%
  select(PLAYER,TEAM,AGE,GP,W,L,MIN,PTS,PPG,everything()) %>%
  select(-FP)
equipos2022 <- equipos2022 %>%
  na.omit()
```


```{r}
library(tidyr)
all_seasons <- bind_rows(jugadoresNBA_2022,jugadoresNBA_2023)
max_puntos <- all_seasons %>% select(PLAYER,PPG,SEASON) %>%
  mutate(PPG = round(PPG,2)) %>%
  arrange(desc(PPG)) %>%
  pivot_wider(names_from = SEASON, values_from = PPG) %>%
  head(20)

```

Máximos anotadores
```{r}
max_anotadores <- all_seasons %>% select(PLAYER,PPG,SEASON) %>%
  arrange(desc(PPG)) %>%
  head(20) 
  
```


```{r}
library(ggplot2)
# Crear el gráfico de barras
ggplot(max_anotadores, aes(x = PLAYER, y = PPG, fill = SEASON)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = round(PPG,2)), 
            position = position_dodge(width = 0.9), 
            vjust = 0.5, hjust = 3.5, # Centramos el texto
            angle = 90, size = 3.5) +
  labs(title = "Máximos Anotadores",
       x = "Jugador", 
       y = "Puntos por Partido (PPG)",
       fill = "Temporada") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```

Máximos asistentes
```{r}
max_asistentes <- all_seasons %>% select(PLAYER,AST,SEASON) %>%
  arrange(desc(AST)) %>%
  head(20)
  
```


```{r}
# Crear el gráfico de barras
ggplot(max_asistentes, aes(x = PLAYER, y = AST, fill = SEASON)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = AST), 
            position = position_dodge(width = 0.9), 
            vjust = 0.5, hjust = 5, # Centramos el texto
            angle = 90, size = 3.5) +
  labs(title = "Máximos asistentes",
       x = "Jugador", 
       y = "Asistencias totales",
       fill = "Temporada") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))


```


Máximos reboteadores

```{r}
max_reboteadores <- all_seasons %>% select(PLAYER,REB,SEASON) %>%
  arrange(desc(REB)) %>%
  head(20)
```

```{r}
# Crear el gráfico de barras
ggplot(max_reboteadores, aes(x = PLAYER, y = REB, fill = SEASON)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = REB), 
            position = position_dodge(width = 0.9), 
            vjust = 0.5, hjust = 5, # Centramos el texto
            angle = 90, size = 3.5) +
  labs(title = "Máximos reboteadores",
       x = "Jugador", 
       y = "Rebotes totales",
       fill = "Temporada") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))


```


4.1 Predicción del MVP
4.1.1 Preparación de datos

```{r}
datos_MVP2022 <- jugadoresNBA_2022 %>%
  mutate(AST = round(AST / GP,2),
         REB = round(REB / GP,2),
         TOV = round(TOV / GP,2),
         STL = round(STL / GP,2)) %>%
  select(PLAYER,PPG,AST,REB,`FG%`, TOV, STL, DD2, TD3) 
  
```

```{r}
# Calcular el puntaje combinado
datos_MVP2022 <- datos_MVP2022 %>%
  mutate(PPG = round(PPG,2)) %>%
  mutate(Puntaje_Combinado = 
  PPG * 0.4 + 
  AST * 0.15 + 
  REB * 0.15 + 
  `FG%` * 0.05 +
  TOV * -0.2 + 
  STL * 0.05 + 
  DD2 * 0.05 + 
  TD3 * 0.05 +
  equipos2022$W * 0.1)

# Ordenar por puntaje combinado para encontrar el MVP
mvp_2022 <- datos_MVP2022[which.max(datos_MVP2022$Puntaje_Combinado), ]

print(mvp_2022)

```

```{r}
datos_MVP2023 <- jugadoresNBA_2023 %>%
  mutate(AST = round(AST / GP,2),
         REB = round(REB / GP,2),
         TOV = round(TOV / GP,2),
         STL = round(STL / GP,2)) %>%
  select(PLAYER,PPG,AST,REB,`FG%`, TOV, STL, DD2, TD3) 
  
```

```{r}
# Asignar pesos a cada métrica
pesos <- c(PPG = 0.4, Asistencias = 0.2, Rebotes = 0.2, PorcentajeTiros = 0.2)

# Calcular el puntaje combinado
datos_MVP2023 <- datos_MVP2023 %>%
  mutate(PPG = round(PPG,2)) %>%
  mutate(Puntaje_Combinado = 
  PPG * 0.4 + 
  AST * 0.15 + 
  REB * 0.15 + 
  `FG%` * 0.05 +
  TOV * -0.2 + 
  STL * 0.05 + 
  DD2 * 0.05 + 
  TD3 * 0.05 +
  equipos2023$W * 0.1)

# Ordenar por puntaje combinado para encontrar el MVP
mvp_2023 <- datos_MVP2023[which.max(datos_MVP2023$Puntaje_Combinado), ]

print(mvp_2023)

```


```{r}
library(dplyr)
library(caret)
library(ggplot2)
library(randomForest)

# Seleccionar características relevantes
X <- jugadoresNBA_2023 %>% select(PLAYER,PTS, AST, REB,`FG%`, TOV, STL, DD2, TD3)
X <- X %>%
 mutate(MVP_votes = PTS * 0.7 + AST * 0.5 + REB * 0.5 + TD3 * 0.2 + DD2 * 0.1)
y <- X$MVP_votes


```

